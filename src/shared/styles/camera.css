/* moved from src/shared/camera.css (see git history for prior changes) */
:root {
  --dr-bg: rgba(2, 6, 23, 0.25);
  --dr-modal-bg: #1c1d23;
  --dr-accent: #e6eef8;
  --dr-success: 56, 255, 60; /* used as rgb parts */
  --dr-failure: 255, 61, 91;
  --dr-target-size: 220px; /* increased default to make detection zone larger */
  /* frame size defaults (percent of video) */
  --frame-w: 72%;
  --frame-h: 42%;
}

.dr-camera-overlay {
  position: fixed;
  inset: 0;
  background: var(--dr-bg);
  backdrop-filter: blur(6px) saturate(110%);
  -webkit-backdrop-filter: blur(6px) saturate(110%);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 60;
  -webkit-font-smoothing: antialiased;
}

/* Mobile / small screens: render the camera modal as part of the page flow so
   it can scroll out of view and doesn't appear 'stuck' under a fixed navbar.
   The navbar height can be provided via --nav-height; default is 56px. */
/* expand to include tablets/large phones where the header is often fixed */
@media (max-width: 1200px) {
  .dr-camera-overlay {
    position: relative !important; /* in-flow */
    inset: auto;
    background: transparent; /* don't obscure page when in-flow */
    backdrop-filter: none;
    -webkit-backdrop-filter: none;
    display: block;
    align-items: stretch;
    justify-content: stretch;
    z-index: 30; /* under top-level fixed navbar which likely has higher z-index */
    padding: 0 12px;
  }
  .dr-camera-modal {
    width: 100%;
    max-width: none;
    border-radius: 8px;
    margin: calc(var(--nav-height, 56px) + 8px) 0 16px; /* push below the fixed navbar */
    box-shadow: 0 6px 20px rgba(0,0,0,0.18);
  }
  /* when in-flow, ensure preview modal is also in-flow/relative so it scrolls with the page */
  .dr-photo-preview-modal {
    position: relative;
    background: transparent;
    box-shadow: none;
    padding: 0;
  }
  .dr-photo-card { box-shadow: 0 8px 30px rgba(0,0,0,0.12); }
}
.dr-camera-modal {
  width: 92%;
  max-width: 520px;
  background: var(--dr-modal-bg);
  border-radius: 12px;
  padding: 14px;
  color: var(--dr-accent);
}
.dr-camera-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 6px 2px;
}
.dr-header-left {
  display: flex;
  gap: 8px;
  align-items: center;
}
.dr-mode-icon {
  background: transparent;
  border: 0;
  color: rgba(230, 238, 248, 0.5);
  padding: 6px;
  border-radius: 8px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
}
.dr-mode-icon.active {
  color: var(--dr-accent);
  background: rgba(255,255,255,0.04);
  box-shadow: 0 6px 18px rgba(0,0,0,0.22);
}

.dr-camera-header .dr-header-left::after {
  content: "";
  width: 1px;
  height: 28px;
  background: rgba(255,255,255,0.06);
  margin-left: 8px;
  margin-right: 12px;
  display: inline-block;
}

.dr-shutter-wrap {
  display: flex;
  justify-content: center;
  margin-top: 8px;
  position: relative;
}
.dr-shutter {
  background: transparent;
  border: 0;
  display: inline-grid;
  place-items: center;
  width: 64px;
  height: 64px;
  border-radius: 999px;
  transition: transform 160ms ease;
  cursor: pointer;
  position: relative;
  z-index: 40;
}
.dr-shutter:active { transform: scale(0.96); }

/* pulsing ring centered and modest size */
.dr-shutter::after {
  content: "";
  position: absolute;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  width: 64px;
  height: 64px;
  border-radius: 999px;
  /* pulse intentionally disabled for a more neutral capture UX */
  box-shadow: none;
  pointer-events: none;
  z-index: 30;
  transition: transform 160ms ease, opacity 160ms ease;
  opacity: 0.0;
}
/* active, short pulse when clicking */
.dr-shutter.shutter-active::after {
  /* kept for compatibility but does not render by default */
  transform: translate(-50%, -50%) scale(0.98);
  opacity: 0;
}
.dr-camera-title {
  font-weight: 700;
  font-size: 16px;
}
.dr-camera-close {
  background: transparent;
  border: 0;
  color: var(--dr-accent);
  font-size: 20px;
  padding: 6px 8px;
  border-radius: 8px;
}
.dr-camera-close:hover {
  background: rgba(255, 255, 255, 0.03);
}
.dr-camera-body {
  margin-top: 10px;
}
.dr-camera-video {
  width: 100%;
  height: 260px;
  background: #000;
  border-radius: 10px;
  object-fit: cover;
}

/* Mode-specific viewport aspect ratios */
.dr-camera-video-wrap.mode-barcode .dr-camera-video {
  height: auto;
  aspect-ratio: 16 / 9;
}
.dr-camera-video-wrap.mode-photo .dr-camera-video {
  height: auto;
  aspect-ratio: 3 / 4; /* taller, more phone-like */
}
.dr-camera-video-wrap.mode-image .dr-camera-video {
  height: auto;
  aspect-ratio: 4 / 5;
}
.dr-camera-instructions {
  font-size: 13px;
  color: #9aa7b2;
  margin-top: 8px;
  display: flex;
  align-items: center;
  gap: 8px;
}
.dr-camera-actions {
  display: flex;
  justify-content: center;
  align-items: center;
  margin-top: 12px;
}
.dr-camera-btn {
  padding: 10px 14px;
  border-radius: 10px;
  border: 0;
  background: #1f2937;
  color: var(--dr-accent);
}
.dr-capture-btn {
  display: none; /* replaced by centered shutter */
}

.dr-camera-video-wrap {
  position: relative;
  border-radius: 10px;
  overflow: hidden;
}
.dr-frame-mask {
  position: absolute;
  inset: 0;
  pointer-events: none;
  z-index: 12;
}
.dr-frame-inner {
  position: absolute;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  width: var(--frame-w);
  height: var(--frame-h);
  border-radius: 10px;
  background: transparent;
  pointer-events: none;
  transition: box-shadow 180ms ease, border-color 160ms ease;
  border: 0;
}

/* Inner dashed guide inside the open frame. Using an inset pseudo-element
   guarantees perfect pixel alignment with the dimmed hole created by
   the large outside box-shadow on .dr-frame-inner. */
.dr-frame-inner::before {
  /* inner guide removed â€” keep pseudo-element reserved in case we need
     to reintroduce a non-rendered helper; ensure it produces no visible output */
  content: "";
  display: block;
  position: absolute;
  inset: 0;
  pointer-events: none;
  border: none;
  box-shadow: none;
  opacity: 0;
  z-index: -1;
}

.dr-camera-video-wrap .dr-frame-inner {
  /* reliable dim-only frame: large outside box-shadow produces a clean punched-out dim */
  box-shadow: 0 0 0 9999px rgba(2, 6, 23, 0.72);
}
.dr-target-overlay {
  position: absolute;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  pointer-events: none;
  z-index: 18;
}
.dr-target-center {
  position: absolute;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  width: var(--frame-w);
  height: var(--frame-h);
  border-radius: 10px;
  background: transparent;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: transform 200ms cubic-bezier(0.2, 0.9, 0.3, 1),
    background-color 200ms ease, border-color 200ms ease, box-shadow 200ms ease;
  transform-origin: center;
  z-index: 22;
}

/* Prevent any duplicate/legacy dashed border or glow on the target center that
   could produce an offset rectangle artifact (built bundles sometimes include
   older styles). We render the dashed outline from the single source
   `.dr-frame-inner` so it aligns perfectly with the dim frame. */
.dr-target-center {
  border: 0 !important;
  box-shadow: none !important;
  outline: none !important;
  background: transparent !important;
}
.dr-camera-video-wrap.dr-success .dr-frame-inner {
  box-shadow: 0 0 0 9999px rgba(56, 255, 60, 0.08),
    inset 0 0 40px rgba(56, 255, 60, 0.04);
  border-color: rgba(var(--dr-success), 0.98);
}
.dr-camera-video-wrap.dr-success .dr-target-center {
  box-shadow: 0 8px 26px rgba(56, 255, 60, 0.85);
}

.dr-camera-video-wrap.dr-success .dr-frame-inner::after {
  border-color: rgba(var(--dr-success), 0.14);
  box-shadow: inset 0 8px 40px rgba(var(--dr-success), 0.06);
}

.dr-target-center.dr-good {
  border-color: rgba(var(--dr-success), 0.98);
  box-shadow: 0 0 26px rgba(56, 142, 60, 0.34);
  background: rgba(56, 142, 60, 0.06);
  transform: scale(1.08);
}
.dr-target-center.dr-bad {
  border-color: rgba(var(--dr-failure), 0.98);
  box-shadow: 0 0 16px rgba(211, 47, 47, 0.16);
  transform: scale(0.98);
}
.dr-check {
  font-size: 34px;
  color: #fff;
  display: inline-block;
  transform: scale(0);
  opacity: 0;
  transition: transform 420ms cubic-bezier(0.2, 0.9, 0.3, 1),
    opacity 260ms linear;
}
.dr-target-center.dr-good .dr-check {
  transform: scale(1.22) rotate(-4deg);
  opacity: 1;
}

/* more explicit pulse transform on the target center when dr-pulse class is present */
.dr-pulse .dr-target-center {
  /* pulse effect preserved for target center but kept very subtle */
  animation: dr-pulse-key 760ms cubic-bezier(0.2, 0.9, 0.3, 1) 1;
}

.dr-device-select {
  margin-top: 8px;
  display: flex;
  gap: 8px;
  align-items: center;
}
.dr-device-select select {
  background: #0b1220;
  color: var(--dr-accent);
  border-radius: 8px;
  padding: 8px;
  border: 0;
}
.dr-camera-error {
  margin-top: 10px;
  color: #ffdede;
  font-size: 13px;
  max-width: 480px;
}

.dr-start-overlay {
  position: absolute;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  background: linear-gradient(
    180deg,
    rgba(2, 6, 23, 0.6),
    rgba(2, 6, 23, 0.42)
  );
}
.dr-start-btn {
  padding: 12px 18px;
  border-radius: 12px;
  border: 0;
  background: #0ea5a6;
  color: #04202a;
  font-weight: 700;
}

@keyframes dr-pulse-key {
  0% {
    transform: scale(1);
  }
  30% {
    transform: scale(1.06);
  }
  60% {
    transform: scale(0.995);
  }
  100% {
    transform: scale(1);
  }
}
.dr-pulse {
  animation: dr-pulse-key 760ms cubic-bezier(0.2, 0.9, 0.3, 1) 1;
}

/* snap highlight when result centroid is near center */
.dr-target-center.snap {
  outline: 3px solid rgba(255, 255, 255, 0.06);
  box-shadow: 0 0 28px rgba(56, 142, 60, 0.42),
    inset 0 0 18px rgba(56, 142, 60, 0.06);
  transform: scale(1.1);
  transition: transform 180ms ease, box-shadow 200ms ease,
    outline-color 200ms ease;
}

/* Mode-specific frame styles */
.dr-camera-video-wrap.mode-barcode {
  --frame-w: 72%;
  --frame-h: 42%;
}
.dr-camera-video-wrap.mode-barcode .dr-frame-inner {
  border: 0;
  box-shadow: 0 0 0 9999px rgba(2, 6, 23, 0.62);
} /* keep outside dim */
.dr-camera-video-wrap.mode-barcode .dr-frame-inner::after {
  content: "";
  position: absolute;
  left: 0;
  top: 0;
  right: 0;
  bottom: 0;
  border-radius: inherit;
  pointer-events: none;
  /* keep subtle inner edge but remove the previously visible border that
     duplicated the dashed outline (caused offset artifacts) */
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.02), inset 0 -1px 0 rgba(0, 0, 0, 0.08);
  border: none;
}

/* Draw the dashed outline from the frame-inner (single authoritative source).
   This guarantees perfect alignment between the dim frame and the dashed guide. */
.dr-camera-video-wrap.mode-barcode .dr-frame-inner {
  /* keep outside dim only; inner dashed guide is provided by ::before */
  border: 0;
  /* ensure the frame's pseudo elements cannot overflow and create stray rectangles */
  overflow: hidden;
}
.dr-camera-video-wrap.mode-barcode .dr-frame-inner::before {
  /* subtle bottom accent line */
  content: "";
  position: absolute;
  left: 8%;
  right: 8%;
  bottom: 8px;
  height: 6px;
}

/* Photo mode: use a taller viewport and tighter frame closer to a phone photo AR */
.dr-camera-video-wrap.mode-photo {
  --frame-w: 82%;
  --frame-h: 66%;
}
.dr-camera-video-wrap.mode-photo .dr-frame-inner {
  box-shadow: 0 0 0 9999px rgba(2, 6, 23, 0.62);
}

/* Image mode: similar to photo but slightly smaller frame to suggest preview/analysis */

/* Preview modal card and animation */
.dr-photo-preview-modal {
  position: fixed;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(0,0,0,0.6);
  z-index: 1200;
  padding: 20px;
}
.dr-photo-card {
  background: var(--dr-modal-bg);
  padding: 12px;
  border-radius: 10px;
  max-width: 92%;
  max-height: 86%;
  box-shadow: 0 8px 30px rgba(0,0,0,0.6);
  display: flex;
  flex-direction: column;
  gap: 12px;
  overflow: auto;
}
.dr-photo-img {
  max-width: 100%;
  max-height: 60vh;
  object-fit: contain;
  border-radius: 6px;
}
.dr-animate-in {
  transform: translateY(8px) scale(0.995);
  opacity: 0;
  animation: dr-modal-in 220ms cubic-bezier(.2,.9,.3,1) forwards;
}
@keyframes dr-modal-in {
  to { transform: translateY(0) scale(1); opacity: 1; }
}

.dr-animate-out {
  animation: dr-modal-out 180ms ease forwards;
}
@keyframes dr-modal-out {
  to { transform: translateY(6px) scale(0.995); opacity: 0; }
}
